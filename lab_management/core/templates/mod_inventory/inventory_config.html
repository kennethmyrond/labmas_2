{% extends 'temp_navbar.html' %}
{% load socialaccount %}
{% block title %}Config{% endblock %}
{% block content %}
<head>
  <style type="text/css">
    .entrytable{
        border-collapse: collapse; 
        width: 40%;
        background-color: rgb(240, 240, 240);
    }
    td{
        padding: 10px;
        text-align: left;
    }
    #deletecol{
        background-color: white;
    }
    #deletebtn{
        color: red;
    }
    #deletebtn:hover{
        text-decoration: underline;
    }
    tr:nth-child(even){
        background-color: rgb(215, 215, 215);
    }
    #flexbox{
        display: flex;
        align-items: flex-start;
    }
    #inputbox{
        width: 100%;
        margin-right:1%;
    }
    #childflex{
        display: flex;
        width: 10%
    }
    .defaultattribute{
        color:grey;
    }
    .form-select{
        width: 100%;
    }
  </style>
</head>

<div class="pagetitle">
  <h1>Inventory</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item active">Configurations</li>
    </ol>
  </nav>
</div><!-- End Page Title -->

<section class="section">
    <div class="row">
        <div class="col-lg-12">

            <div class="card">
                <div class="card-body">
                    
                    <!-- ADD CATEGORY -->
                    <h5 class="card-title">Add Category</h5>
                    <form id="updateForm" method="POST" action="">
                        {% csrf_token %}
                        <div id="form-container">
                            <div class="form-set">
 
                            <div id="flexbox">
                                <div class="row mb-3" id="inputbox">
                                    <label for="category" class="col-sm-2 col-form-label">Category:</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="category" id="category" required oninput="suggestItems(this.value)" required>
                                        <div id="suggestions" class="suggestions"></div> <!-- Suggestions div -->
                                    </div>
                                </div>
                                <div class="row mb-3" id="childflex">
                                    <div class="col-sm-10 d-flex">
                                        <button type="submit" class="btn btn-primary me-2" id="add">Add</button>
                                    </div>
                                </div>
                            </div>

                                <!--entry table-->
                                <div class="">
                                <table class="entrytable" id="categoryTable">
                                    <tr>
                                        <td>Chemicals</td>
                                        <td id="deletecol">
                                            <btn id="deletebtn">Delete</btn>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Glasswares</td>
                                        <td id="deletecol">
                                            <btn id="deletebtn">Delete</btn>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Equipment</td>
                                        <td id="deletecol">
                                            <btn id="deletebtn">Delete</btn>
                                        </td>
                                    </tr>
                                </table>
                                </div>

                            </div>
                        </div>
                    </form><!-- End General Form Elements -->


                    <!-- ADD COLUMNS -->
                    <h5 class="card-title">Add Category Attributes</h5>
                    <form id="attributeForm" method="POST" action="">
                        {% csrf_token %}
                        <div id="form-container">
                            <div class="form-set">
                            
                                <div class="row mb-3">
                                    <label for="category" class="col-sm-2 col-form-label">Category:</label>
                                    <div class="col-sm-10">
                                        <select class="form-select" id="category" name="category" required onchange="toggleActionFields()" required>
                                            <option value="category">Chemicals</option>
                                            <option value="category">Glasswares</option>
                                            <option value="category">Equipment</option>
                                        </select>
                                    </div>
                                </div>
 
                            <div id="flexbox">
                                <div class="row mb-3" id="inputbox">
                                    <label for="attributeName" class="col-sm-2 col-form-label">Attribute Name:</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="attributeName id="attributeName" required oninput="suggestItems(this.value)" required>
                                        <div id="suggestions" class="suggestions"></div> <!-- Suggestions div -->
                                    </div>
                                </div>
                                <div class="row mb-3" id="childflex">
                                    <div class="col-sm-10 d-flex">
                                        <button type="submit" class="btn btn-primary me-2" id="add">Add</button>
                                    </div>
                                </div>
                            </div>

                                <!--entry table-->
                                <div class="">
                                <table class="entrytable" id="categoryTable">
                                    <tr>
                                        <td class="defaultattribute">Item Name</td>
                                        <td id="deletecol"></td>
                                    </tr>
                                    <tr>
                                        <td  class="defaultattribute">Type</td>
                                        <td id="deletecol"></td>
                                    </tr>
                                    <tr>
                                        <td class="defaultattribute">Amount</td>
                                        <td id="deletecol"></td>
                                    </tr>
                                    <tr>
                                        <td class="defaultattribute">Dimension</td>
                                        <td id="deletecol"></td>
                                    </tr>
                                    <tr>
                                        <td>Chemicals</td>
                                        <td id="deletecol">
                                            <btn id="deletebtn">Delete</btn>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Glasswares</td>
                                        <td id="deletecol">
                                            <btn id="deletebtn">Delete</btn>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Equipment</td>
                                        <td id="deletecol">
                                            <btn id="deletebtn">Delete</btn>
                                        </td>
                                    </tr>
                                </table>
                                </div>

                            </div>
                        </div>
                    </form><!-- End General Form Elements -->
                    


                </div>
            </div>

        </div>
    </div>
</section>



<script>

    $(document).ready(function() {
        $('#itemSupplier').select2({
            ajax: {
                url: '/suggest_suppliers',  // Your URL endpoint to fetch supplier suggestions
                dataType: 'json',
                delay: 250,  // Delay in milliseconds to wait before triggering the request
                data: function(params) {
                    return {
                        query: params.term // The search term that user enters
                    };
                },
                processResults: function(data) {
                    return {
                        results: data.map(function(supplier) {
                            return {
                                id: supplier.suppliers_id, // The ID that will be the value of the option
                                text: supplier.supplier_name // The text that will be displayed in the dropdown
                            };
                        })
                    };
                },
                placeholder: 'Search for a supplier',
                minimumInputLength: 2
            }
        });
    });


    function suggestItems(query) {
        if (query.length < 2) {
            document.getElementById('suggestions').innerHTML = '';
            return;
        }

        fetch(`/suggest_items?query=${query}`)
            .then(response => response.json())
            .then(data => {
                let suggestions = document.getElementById('suggestions');
                suggestions.innerHTML = '<table class="table"><thead><tr><th>Item Name</th><th>Amount</th><th>Dimension</th><th>Additional Info</th><th>Qty</th></tr></thead><tbody></tbody></table>';
                let tbody = suggestions.querySelector('tbody');
                
                data.forEach(item => {
                    let addCols = '';  // String to store formatted add_cols
                    for (const [key, value] of Object.entries(item.add_cols)) {
                        addCols += `<strong>${key}:</strong> ${value} <br>`;  // Format add_cols as key-value pairs
                    }

                    let row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.item_name}</td>
                        <td>${item.amount}</td>
                        <td>${item.dimension}</td>
                        <td>${addCols}</td>  <!-- Display add_cols -->
                        <td>${item.qty}</td>
                    `;
                    row.onclick = () => selectItem(item.item_name, item.amount, item.dimension, item.qty, item.add_cols);
                    tbody.appendChild(row);
                });
            });
    }

    function selectItem(itemName, amount, dimension, qty, addCols) {
        document.getElementById('itemName').value = itemName;
        document.getElementById('suggestions').innerHTML = ''; // Clear suggestions
        // Optionally set other fields, e.g., dimension, qty
        console.log(addCols);  // You can process addCols if needed
    }

    function toggleActionFields() {
        const actionType = document.getElementById('actionType').value;
        const addFields = document.getElementById('addFields');
        const removeFields = document.getElementById('removeFields');

        if (actionType === 'add') {
            addFields.style.display = 'block';
            removeFields.style.display = 'none';
        } else {
            addFields.style.display = 'none';
            removeFields.style.display = 'block';
        }
    }

    function saveTransaction() {
        // You can implement logic here to save the entire transaction when the user clicks "Save"
        alert('Transaction saved!');
    }
</script>



<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

{% endblock %}
