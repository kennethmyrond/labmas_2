{% extends 'temp_navbar.html' %}
{% load socialaccount inventory_extras %}
{% block title %}Supplier Details{% endblock %}

{% block content %}
  <div class="pagetitle">
    <h1>Inventory</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'inventory_manageSuppliers' %}">Manage Suppliers</a></li>
        <li class="breadcrumb-item active">Supplier Details</li>
      </ol>
    </nav>
  </div><!-- End Page Title -->

  <section class="section">
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{ supplier.supplier_name }}</h5>

            <!-- Supplier Information -->
            <p><strong>Contact Person:</strong> {{ supplier.contactPerson }}</p>
            <p><strong>Address:</strong> {{ supplier.address }}</p>
            <p><strong>Description:</strong> {{ supplier.description }}</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Items Supplied by {{ supplier.supplier_name }}</h5>
            
            <!-- Table with stripped rows -->
            <table class="table datatable">
              <thead>
                <tr>
                  <th>Item Name</th>
                  <th>Date Purchased</th>
                  <th>Date Received</th>
                  <th>Quantity</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for handling in item_handling_entries %}
                  <tr>
                    <td>{{ handling.inventory_item.item.item_name }}</td>
                    <td>{{ handling.inventory_item.date_purchased|date:"Y-m-d" }}</td>
                    <td>{{ handling.inventory_item.date_received|date:"Y-m-d" }}</td>
                    <td>{{ handling.qty }}</td>
                    <td>
                      <!-- Button to open the details modal -->
                      <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#inventoryDetailsModal{{ handling.inventory_item.inventory_item_id }}">
                        View Details
                      </button>

                      <!-- Modal for Viewing Item Handling Details -->
                      <div class="modal fade" id="inventoryDetailsModal{{ handling.inventory_item.inventory_item_id }}" tabindex="-1" role="dialog" aria-labelledby="inventoryDetailsModalLabel{{ handling.inventory_item.inventory_item_id }}" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="inventoryDetailsModalLabel{{ handling.inventory_item.inventory_item_id }}">Inventory Details</h5>
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </div>
                            <div class="modal-body">
                              <h6>Item: {{ handling.inventory_item.item.item_name }}</h6>
                              <ul>
                                <li><strong>Quantity Added:</strong> {{ handling.qty }}</li>
                                <li><strong>Purchase Price:</strong> {{ handling.inventory_item.purchase_price }}</li>
                                <li><strong>Date Purchased:</strong> {{ handling.inventory_item.date_purchased|date:"Y-m-d" }}</li>
                                <li><strong>Date Received:</strong> {{ handling.inventory_item.date_received|date:"Y-m-d" }}</li>
                                <li><strong>Supplier:</strong> 
                                  {% if handling.inventory_item.supplier %}
                                      {{ handling.inventory_item.supplier.supplier_name }}
                                  {% else %}
                                      N/A
                                  {% endif %}
                                </li>
                                <li><strong>Remarks:</strong> {{ handling.inventory_item.remarks }}</li>
                              </ul>
                              <hr>
                              <h6>Handling Info</h6>
                              <ul>
                                <li><strong>Updated By:</strong> {{ handling.updated_by.email }}</li>
                                <li><strong>Date Updated:</strong> {{ handling.updated_on|date:"Y-m-d H:i" }}</li>
                                <li><strong>Action:</strong> {{ handling.get_changes_display }}</li>
                              </ul>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- End Modal -->
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="5" class="text-center">No handling records found for this supplier.</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
            <!-- End Table with stripped rows -->

          </div>
        </div>
      </div>
    </div>
  </section>
  
{% endblock %}
