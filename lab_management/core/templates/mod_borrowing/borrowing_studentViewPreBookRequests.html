{% extends 'temp_navbar.html' %}
{% load socialaccount %}
{% block title %}View Pre-Book Requests{% endblock %}

{% block content %}
  <div class="pagetitle">
    <h1>Borrowing</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item active">View Borrow Requests</li>
      </ol>
    </nav>
  </div><!-- End Page Title -->

  <!-- Tabs for different statuses -->
  <ul class="nav nav-tabs" id="borrowRequestsTabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="pending-tab" data-toggle="tab" href="#pending" role="tab">Pending</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="accepted-tab" data-toggle="tab" href="#accepted" role="tab">Accepted</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="declined-tab" data-toggle="tab" href="#declined" role="tab">Declined</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="borrowed-tab" data-toggle="tab" href="#borrowed" role="tab">Borrowed</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="cancelled-tab" data-toggle="tab" href="#cancelled" role="tab">Cancelled</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="completed-tab" data-toggle="tab" href="#completed" role="tab">Completed</a>
    </li>
  </ul>

  <!-- Tab content -->
  <div class="tab-content" id="borrowRequestsContent">
    
    <!-- Pending Requests Tab -->
    <div class="tab-pane fade show active" id="pending" role="tabpanel">
      <section class="section">
        <div class="card">
          <div class="card-body">
            <table class="table datatable">
              <thead>
                <tr>
                  <th>RF Number</th>
                  <th>Date Requested</th>
                  <th>Date Needed</th>
                  <th>Type</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for request in pending_requests %}
                <tr>
                  <td>
                    <a href="{% url 'borrowing_studentDetailedPreBookRequests' request.borrow_id %}">
                      {{ request.borrow_id }}
                    </a>
                  </td>
                  <td>{{ request.request_date|date:"Y/m/d" }}</td>
                  <td>{{ request.borrow_date|date:"Y/m/d" }}</td>
                  <td>{% if request.due_date > request.borrow_date %}Long-Term{% else %}One-Day{% endif %}</td>
                  <td><button class="btn btn-danger btn-sm" onclick="cancelRequest('{{ request.borrow_id }}')">Cancel</button></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>

    <!-- Accepted Requests Tab -->
    <div class="tab-pane fade" id="accepted" role="tabpanel">
      <section class="section">
        <div class="card">
          <div class="card-body">
            <table class="table datatable">
              <thead>
                <tr>
                  <th>RF Number</th>
                  <th>Date Requested</th>
                  <th>Date Needed</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody>
                {% for request in accepted_requests %}
                <tr>
                  <td><a href="{% url 'borrowing_studentDetailedPreBookRequests' request.borrow_id %}">{{ request.borrow_id }}</a></td>
                  <td>{{ request.request_date|date:"Y/m/d" }}</td>
                  <td>{{ request.borrow_date|date:"Y/m/d" }}</td>
                  <td>{% if request.due_date %}Long-Term{% else %}One-Day{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>

    <!-- Declined Requests Tab -->
    <div class="tab-pane fade" id="declined" role="tabpanel">
      <section class="section">
        <div class="card">
          <div class="card-body">
            <table class="table datatable">
              <thead>
                <tr>
                  <th>RF Number</th>
                  <th>Date Requested</th>
                  <th>Date Needed</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody>
                {% for request in declined_requests %}
                <tr>
                  <td><a href="{% url 'borrowing_studentDetailedPreBookRequests' request.borrow_id %}">{{ request.borrow_id }}</a></td>
                  <td>{{ request.request_date|date:"Y/m/d" }}</td>
                  <td>{{ request.borrow_date|date:"Y/m/d" }}</td>
                  <td>{% if request.due_date %}Long-Term{% else %}One-Day{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>

    <!-- Borrowed Requests Tab -->
    <div class="tab-pane fade" id="borrowed" role="tabpanel">
      <section class="section">
        <div class="card">
          <div class="card-body">
            <table class="table datatable">
              <thead>
                <tr>
                  <th>RF Number</th>
                  <th>Date Requested</th>
                  <th>Date Needed</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody>
                {% for request in borrowed_requests %}
                <tr>
                  <td><a href="{% url 'borrowing_studentDetailedPreBookRequests' request.borrow_id %}">{{ request.borrow_id }}</a></td>
                  <td>{{ request.request_date|date:"Y/m/d" }}</td>
                  <td>{{ request.borrow_date|date:"Y/m/d" }}</td>
                  <td>{% if request.due_date %}Long-Term{% else %}One-Day{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>

    <!-- Cancelled Requests Tab -->
    <div class="tab-pane fade" id="cancelled" role="tabpanel">
      <section class="section">
        <div class="card">
          <div class="card-body">
            <table class="table datatable">
              <thead>
                <tr>
                  <th>RF Number</th>
                  <th>Date Requested</th>
                  <th>Date Needed</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody>
                {% for request in cancelled_requests %}
                <tr>
                  <td><a href="{% url 'borrowing_studentDetailedPreBookRequests' request.borrow_id %}">{{ request.borrow_id }}</a></td>
                  <td>{{ request.request_date|date:"Y/m/d" }}</td>
                  <td>{{ request.borrow_date|date:"Y/m/d" }}</td>
                  <td>{% if request.due_date %}Long-Term{% else %}One-Day{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>

    <!-- Completed Requests Tab -->
    <div class="tab-pane fade" id="completed" role="tabpanel">
      <section class="section">
        <div class="card">
          <div class="card-body">
            <table class="table datatable">
              <thead>
                <tr>
                  <th>RF Number</th>
                  <th>Date Requested</th>
                  <th>Date Needed</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody>
                {% for request in completed_requests %}
                <tr>
                  <td><a href="{% url 'borrowing_studentDetailedPreBookRequests' request.borrow_id %}">{{ request.borrow_id }}</a></td>
                  <td>{{ request.request_date|date:"Y/m/d" }}</td>
                  <td>{{ request.borrow_date|date:"Y/m/d" }}</td>
                  <td>{% if request.due_date %}Long-Term{% else %}One-Day{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </div>

<script>
  function cancelRequest(rfNumber) {
    // Add your cancellation logic here
    alert('Cancel request for RF Number: ' + rfNumber);
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Get the hash from the URL (e.g., #borrowed, #pending)
    const hash = window.location.hash;
    
    if (hash) {
      // Activate the tab corresponding to the hash
      const tab = document.querySelector(`a[href="${hash}"]`);
      if (tab) {
        tab.click(); // Simulate a click to activate the tab
      }
    }
  });
</script>

<style>
  .custom-cancel-btn {
    padding: 0.2rem 0.5rem; 
    font-size: 0.75rem; 
  }
</style>

{% endblock %}
